$.extend($.fn.datagrid.defaults,{rowHeight:25,maxDivHeight:1E7,maxVisibleHeight:15E6,deltaTopHeight:0,onBeforeFetch:function(a){},onFetch:function(a,b){},loader:function(a,b,e){var c=$(this).datagrid("options");if(!c.url)return!1;"scrollview"==c.view.type&&(a.page=a.page||1,a.rows=a.rows||c.pageSize);$.ajax({type:c.method,url:c.url,data:a,dataType:"json",success:function(a){b(a)},error:function(){e.apply(this,arguments)}})}});$.extend($.fn.datagrid.defaults.finder,{getRow:function(a,b){var e="object"==typeof b?b.attr("datagrid-row-index"):b,c=$.data(a,"datagrid").data,d=$(a).datagrid("options");if("scrollview"==d.view.type){if(e<c.firstRows.length)return c.firstRows[e];e-=d.view.index}return c.rows[e]}});var scrollview=$.extend({},$.fn.datagrid.defaults.view,{type:"scrollview",index:0,r1:[],r2:[],rows:[],render:function(a,b,e){var c=$.data(a,"datagrid"),d=c.options,f=this.rows||[];if(f.length){var g=$(a).datagrid("getColumnFields",e);if(!e||d.rownumbers||d.frozenColumns&&d.frozenColumns.length){for(var k=this.index,h=['\x3cdiv class\x3d"datagrid-btable-top"\x3e\x3c/div\x3e','\x3ctable class\x3d"datagrid-btable" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0"\x3e\x3ctbody\x3e'],m=0;m<f.length;m++){var l=d.rowStyler?d.rowStyler.call(a,k,f[m]):"",p="",n="";"string"==typeof l?n=l:l&&(p=l["class"]||"",n=l.style||"");h.push('\x3ctr id\x3d"'+(c.rowIdPrefix+"-"+(e?1:2)+"-"+k)+'" datagrid-row-index\x3d"'+k+'" '+('class\x3d"datagrid-row '+(k%2&&d.striped?"datagrid-row-alt ":" ")+p+'"')+" "+(n?'style\x3d"'+n+'"':"")+"\x3e");h.push(this.renderRow.call(this,a,g,e,k,f[m]));h.push("\x3c/tr\x3e");d.detailFormatter&&(h.push('\x3ctr style\x3d"display:none;"\x3e'),e?h.push("\x3ctd colspan\x3d"+(g.length+(d.rownumbers?1:0))+' style\x3d"border-right:0"\x3e'):h.push("\x3ctd colspan\x3d"+g.length+"\x3e"),h.push('\x3cdiv class\x3d"datagrid-row-detail"\x3e'),e?h.push("\x26nbsp;"):h.push(d.detailFormatter.call(a,k,f[m])),h.push("\x3c/div\x3e"),h.push("\x3c/td\x3e"),h.push("\x3c/tr\x3e"));k++}h.push("\x3c/tbody\x3e\x3c/table\x3e");h.push('\x3cdiv class\x3d"datagrid-btable-bottom"\x3e\x3c/div\x3e');$(b).html(h.join(""))}}},renderRow:function(a,b,e,c,d){var f=$.data(a,"datagrid").options,g=[];e&&f.rownumbers&&g.push('\x3ctd class\x3d"datagrid-td-rownumber"\x3e\x3cdiv class\x3d"datagrid-cell-rownumber"\x3e'+(c+1)+"\x3c/div\x3e\x3c/td\x3e");for(e=0;e<b.length;e++){var k=b[e],h=$(a).datagrid("getColumnOption",k);if(h){var m=d[k],l=h.styler?h.styler(m,d,c)||"":"",p="",n="";"string"==typeof l?n=l:g&&(p=l["class"]||"",n=l.style||"");l=h.hidden?'style\x3d"display:none;'+n+'"':n?'style\x3d"'+n+'"':"";g.push('\x3ctd field\x3d"'+k+'" '+(p?'class\x3d"'+p+'"':"")+" "+l+"\x3e");h.checkbox?l="":h.expander?l="text-align:center;height:16px;":(l=n,h.align&&(l+=";text-align:"+h.align+";"),f.nowrap?f.autoRowHeight&&(l+=";height:auto;"):l+=";white-space:normal;height:auto;");g.push('\x3cdiv style\x3d"'+l+'" ');h.checkbox?g.push('class\x3d"datagrid-cell-check '):g.push('class\x3d"datagrid-cell '+h.cellClass);g.push('"\x3e');h.checkbox?g.push('\x3cinput type\x3d"checkbox" name\x3d"'+k+'" value\x3d"'+(void 0!=m?m:"")+'"\x3e'):h.expander?g.push('\x3cspan class\x3d"datagrid-row-expander datagrid-row-expand" style\x3d"display:inline-block;width:16px;height:16px;cursor:pointer;" /\x3e'):h.formatter?g.push(h.formatter(m,d,c)):g.push(m);g.push("\x3c/div\x3e");g.push("\x3c/td\x3e")}}return g.join("")},bindEvents:function(a){var b=$.data(a,"datagrid").dc,b=b.body1.add(b.body2),e=($.data(b[0],"events")||$._data(b[0],"events")).click[0].handler;b.unbind("click").bind("click",function(b){var d=$(b.target),c=d.closest("tr.datagrid-row");c.length&&(d.hasClass("datagrid-row-expander")?(c=parseInt(c.attr("datagrid-row-index")),d.hasClass("datagrid-row-expand")?$(a).datagrid("expandRow",c):$(a).datagrid("collapseRow",c),$(a).datagrid("fixRowHeight")):e(b),b.stopPropagation())})},onBeforeRender:function(a){var b=$.data(a,"datagrid"),e=b.options,c=b.dc,d=this;e._emptyMsg=e.emptyMsg;e.emptyMsg="";b.data.firstRows=b.data.rows;b.data.rows=[];c.body1.add(c.body2).empty();this.rows=[];this.r1=this.r2=[];(function(){var f=$(a).datagrid("getPager");f.each(function(){$(this).pagination("options").onSelectPage=function(b,c){e.pageNumber=b||1;e.pageSize=c;f.pagination("refresh",{pageNumber:b,pageSize:c});$(a).datagrid("gotoPage",e.pageNumber)}});b.onLoadSuccess=e.onLoadSuccess;e.onLoadSuccess=function(){};if(!e.remoteSort){var g=e.onBeforeSortColumn;e.onBeforeSortColumn=function(a,c){if(0==g.call(this,a,c))return!1;b.data.rows=b.data.firstRows}}c.body2.unbind(".datagrid");setTimeout(function(){c.body2.unbind(".datagrid").bind("scroll.datagrid",function(c){b.onLoadSuccess&&(e.onLoadSuccess=b.onLoadSuccess,b.onLoadSuccess=void 0);d.scrollTimer&&clearTimeout(d.scrollTimer);d.scrollTimer=setTimeout(function(){d.scrolling.call(d,a)},50)});c.body2.triggerHandler("scroll.datagrid")},0)})();(function(){if(e.detailFormatter){for(var b=$(a),g=!1,k=b.datagrid("getColumnFields",!0).concat(b.datagrid("getColumnFields")),h=0;h<k.length;h++)if(b.datagrid("getColumnOption",k[h]).expander){g=!0;break}g||(e.frozenColumns&&e.frozenColumns.length?e.frozenColumns[0].splice(0,0,{field:"_expander",expander:!0,width:24,resizable:!1,fixed:!0}):e.frozenColumns=[[{field:"_expander",expander:!0,width:24,resizable:!1,fixed:!0}]],b=c.view1.children("div.datagrid-header").find("table"),g=$('\x3ctd rowspan\x3d"'+e.frozenColumns.length+'"\x3e\x3cdiv class\x3d"datagrid-header-expander" style\x3d"width:24px;"\x3e\x3c/div\x3e\x3c/td\x3e'),0==$("tr",b).length?g.wrap("\x3ctr\x3e\x3c/tr\x3e").parent().appendTo($("tbody",b)):e.rownumbers?g.insertAfter(b.find("td:has(div.datagrid-header-rownumber)")):g.prependTo(b.find("tr:first")));setTimeout(function(){d.bindEvents(a)},0)}})()},onAfterRender:function(a){$.fn.datagrid.defaults.view.onAfterRender.call(this,a);a=$.data(a,"datagrid").dc;a.footer1.add(a.footer2).find("span.datagrid-row-expander").css("visibility","hidden")},scrolling:function(a){var b=$.data(a,"datagrid"),e=b.options,c=b.dc;if(e.finder.getRows(a).length){if(c.body2.is(":visible")){var d=c.view2.children("div.datagrid-header").outerHeight(),f=c.body2.children("div.datagrid-btable-top"),g=c.body2.children("div.datagrid-btable-bottom");if(f.length&&g.length)if(f=f.position().top+f._outerHeight()-d,d=g.position().top-d,f=Math.floor(f),d=Math.floor(d),f>c.body2.height()||0>d)this.reload.call(this,a);else if(0<f){var k=Math.floor(this.index/e.pageSize);this.getRows.call(this,a,k,function(b){this.page=k;this.r2=this.r1;this.r1=b;this.index=(k-1)*e.pageSize;this.rows=this.r1.concat(this.r2);this.populate.call(this,a)})}else d<c.body2.height()&&!(b.data.rows.length+this.index>=b.data.total)&&(k=Math.floor(this.index/e.pageSize)+2,this.r2.length&&k++,this.getRows.call(this,a,k,function(b){this.page=k;this.r2.length?(this.r1=this.r2,this.r2=b,this.index+=e.pageSize):this.r2=b;this.rows=this.r1.concat(this.r2);this.populate.call(this,a)}))}}else this.reload.call(this,a)},reload:function(a){var b=$.data(a,"datagrid"),e=b.options,c=b.dc,b=$(c.body2).scrollTop()+e.deltaTopHeight,d=Math.floor(Math.floor(b/e.rowHeight)/e.pageSize)+1;this.getRows.call(this,a,d,function(b){this.page=d;this.index=(d-1)*e.pageSize;this.r1=this.rows=b;this.r2=[];this.populate.call(this,a);c.body2.triggerHandler("scroll.datagrid")})},getRows:function(a,b,e){var c=$.data(a,"datagrid"),d=c.options,f=(b-1)*d.pageSize;d.emptyMsg=d._emptyMsg;this.setEmptyMsg&&this.setEmptyMsg(a);if(!(0>f)&&0!=d.onBeforeFetch.call(a,b)){var g=c.data.firstRows.slice(f,f+d.pageSize);!g.length||g.length!=d.pageSize&&f+g.length!=c.data.total?(f=$.extend({},d.queryParams,{page:b,rows:d.pageSize}),d.sortName&&$.extend(f,{sort:d.sortName,order:d.sortOrder}),0!=d.onBeforeLoad.call(a,f)&&($(a).datagrid("loading"),0==d.loader.call(a,f,function(c){$(a).datagrid("loaded");c=d.loadFilter.call(a,c);d.onFetch.call(a,b,c.rows);c.rows&&c.rows.length?e.call(d.view,c.rows):d.onLoadSuccess.call(a,c)},function(){$(a).datagrid("loaded");d.onLoadError.apply(a,arguments)})&&($(a).datagrid("loaded"),c.data.firstRows.length||(d.onFetch.call(a,b,c.data.firstRows),d.onLoadSuccess.call(a,c.data))))):(d.onFetch.call(a,b,g),e.call(this,g))}},populate:function(a){function b(b,c){var a=Math.floor(c/g),e=c-g*a;0>c&&(e=0);for(var d=[],f=0;f<a;f++)d.push('\x3cdiv style\x3d"height:'+g+'px"\x3e\x3c/div\x3e');d.push('\x3cdiv style\x3d"height:'+e+'px"\x3e\x3c/div\x3e');$(b).html(d.join(""))}var e=$.data(a,"datagrid"),c=e.options,d=e.dc,f=c.rowHeight,g=c.maxDivHeight;if(this.rows.length){c.view.render.call(c.view,a,d.body2,!1);c.view.render.call(c.view,a,d.body1,!0);var k=d.body1.add(d.body2),h=k.children("div.datagrid-btable-top"),k=k.children("div.datagrid-btable-bottom"),m=this.index*f,l=e.data.total*f-this.rows.length*f-m;b(h,m);b(k,l);e.data.rows=this.rows;var p=d.body2.scrollTop()+c.deltaTopHeight;m>c.maxVisibleHeight?(c.deltaTopHeight=m-c.maxVisibleHeight,b(h,m-c.deltaTopHeight)):c.deltaTopHeight=0;l>c.maxVisibleHeight?b(k,c.maxVisibleHeight):0==l&&(h=e.data.total%c.pageSize)&&b(k,d.body2.height()-h*f);$(a).datagrid("setSelectionState");d.body2.scrollTop(p-c.deltaTopHeight);c.pageNumber=this.page;d=$(a).datagrid("getPager");d.length&&(f=d.pagination("options"),h=f.displayMsg,k=h.replace(/{from}/,this.index+1),k=k.replace(/{to}/,this.index+this.rows.length),d.pagination("refresh",{pageNumber:this.page,displayMsg:k}),f.displayMsg=h);this.setEmptyMsg&&this.setEmptyMsg(a);c.onLoadSuccess.call(a,{total:e.data.total,rows:this.rows})}},updateRow:function(a,b,e){function c(b){b=f.rowStyler?f.rowStyler.call(a,b,g):"";var c="",e="";"string"==typeof b?e=b:b&&(c=b["class"]||"",e=b.style||"");return{c:c,s:e}}function d(c){var e=$(a).datagrid("getColumnFields",c),d=f.finder.getTr(a,b,"body",c?1:2),k=d.find("div.datagrid-cell-check input[type\x3dcheckbox]").is(":checked");d.html(this.renderRow.call(this,a,e,c,b,g));d.attr("style",m).removeClass(h).addClass(l);k&&d.find("div.datagrid-cell-check input[type\x3dcheckbox]")._propAttr("checked",!0)}var f=$.data(a,"datagrid").options;$(a).datagrid("getRows");var g=f.finder.getRow(a,b),k=c(b);$.extend(g,e);e=c(b);var h=k.c,m=e.s,l="datagrid-row "+(b%2&&f.striped?"datagrid-row-alt ":" ")+e.c;d.call(this,!0);d.call(this,!1);$(a).datagrid("fixRowHeight",b)},insertRow:function(a,b,e){var c=$.data(a,"datagrid"),d=c.options,f=c.data,g=$(a).datagrid("getData").total;null==b&&(b=g);b>g&&(b=g);f.firstRows&&b<=f.firstRows.length&&f.firstRows.splice(b,0,e);f.total++;f=this.r1.concat(this.r2);b<this.index?this.reload.call(this,a):b<=this.index+f.length&&(f.splice(b-this.index,0,e),this.r1=f.splice(0,d.pageSize),this.r2.length&&(this.r2=f.splice(0,d.pageSize)),this.rows=this.r1.concat(this.r2),this.populate.call(this,a),c.dc.body2.triggerHandler("scroll.datagrid"))},deleteRow:function(a,b){var e=$.data(a,"datagrid"),c=e.data,d=e.options;c.total--;c.firstRows&&b<c.firstRows.length?(c.firstRows.splice(b,1),this.reload.call(this,a)):(c=this.r1.concat(this.r2),b<this.index?this.reload.call(this,a):b<this.index+c.length&&(c.splice(b-this.index,1),this.r1=c.splice(0,d.pageSize),this.r1.length<d.pageSize?this.reload.call(this,a):(this.r2=[],this.rows=this.r1.concat(this.r2),this.populate.call(this,a),e.dc.body2.triggerHandler("scroll.datagrid"))))}});$.fn.datagrid.methods.baseUpdateRow=$.fn.datagrid.methods.updateRow;$.fn.datagrid.methods.baseGetRowIndex=$.fn.datagrid.methods.getRowIndex;$.fn.datagrid.methods.baseScrollTo=$.fn.datagrid.methods.scrollTo;$.fn.datagrid.methods.baseGotoPage=$.fn.datagrid.methods.gotoPage;$.extend($.fn.datagrid.methods,{updateRow:function(a,b){return a.each(function(){if($(this).datagrid("options").finder.getRow(this,b.index))$(this).datagrid("baseUpdateRow",b);else{var a=$(this).datagrid("getData").firstRows||[];b.index<a.length&&$.extend(a[b.index],b.row)}})},getRowIndex:function(a,b){var e=a.datagrid("options");if("scrollview"==e.view.type){var c=a.datagrid("getData"),c="object"==typeof b?$.easyui.indexOfArray(c.firstRows,b):$.easyui.indexOfArray(c.firstRows,e.idField,b);if(0<=c)return c;c=a.datagrid("baseGetRowIndex",b);return-1==c?-1:c+e.view.index}return a.datagrid("baseGetRowIndex",b)},getRow:function(a,b){return a.datagrid("options").finder.getRow(a[0],b)},gotoPage:function(a,b){return a.each(function(){var a=this,c=$(a).datagrid("options");if("scrollview"==c.view.type){var d,f;"object"==typeof b?(d=b.page,f=b.callback):d=b;c.view.getRows.call(c.view,a,d,function(b){this.page=d;this.index=(d-1)*c.pageSize;this.r1=this.rows=b;this.r2=[];this.populate.call(this,a);$(a).data("datagrid").dc.body2.scrollTop(this.index*c.rowHeight-c.deltaTopHeight);f&&f.call(a,d)})}else $(a).datagrid("baseGotoPage",b)})},scrollTo:function(a,b){return a.each(function(){var a=this,c=$(a).datagrid("options"),d,f;"object"==typeof b?(d=b.index,f=b.callback):d=b;var g=c.view;"scrollview"==g.type?d>=g.index&&d<g.index+g.rows.length?($(a).datagrid("baseScrollTo",d),f&&f.call(a,d)):0<=d&&(c=Math.floor(d/c.pageSize)+1,$(a).datagrid("gotoPage",{page:c,callback:function(){setTimeout(function(){$(a).datagrid("baseScrollTo",d);f&&f.call(a,d)},0)}})):($(a).datagrid("baseScrollTo",d),f&&f.call(a,d))})}});$.extend($.fn.datagrid.methods,{fixDetailRowHeight:function(a,b){return a.each(function(){var a=$.data(this,"datagrid").options,c=$.data(this,"datagrid").dc,d=a.finder.getTr(this,b,"body",1).next(),a=a.finder.getTr(this,b,"body",2).next();if(a.is(":visible")){d.css("height","");a.css("height","");var f=Math.max(d.height(),a.height());d.css("height",f);a.css("height",f)}c.body2.triggerHandler("scroll")})},getExpander:function(a,b){return $.data(a[0],"datagrid").options.finder.getTr(a[0],b).find("span.datagrid-row-expander")},getRowDetail:function(a,b){return $.data(a[0],"datagrid").options.finder.getTr(a[0],b,"body",2).next().find("div.datagrid-row-detail")},expandRow:function(a,b){return a.each(function(){var a=$(this).datagrid("options");$.data(this,"datagrid");var c=$(this).datagrid("getExpander",b);if(c.hasClass("datagrid-row-expand")){c.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");var c=a.finder.getTr(this,b,"body",1).next(),d=a.finder.getTr(this,b,"body",2).next();c.show();d.show();$(this).datagrid("fixDetailRowHeight",b);a.onExpandRow&&(c=$(this).datagrid("getRows")[b],a.onExpandRow.call(this,b,c))}})},collapseRow:function(a,b){return a.each(function(){var a=$(this).datagrid("options"),c=$.data(this,"datagrid").dc,d=$(this).datagrid("getExpander",b);if(d.hasClass("datagrid-row-collapse")){d.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");var d=a.finder.getTr(this,b,"body",1).next(),f=a.finder.getTr(this,b,"body",2).next();d.hide();f.hide();c.body2.triggerHandler("scroll");a.onCollapseRow&&(c=$(this).datagrid("getRows")[b],a.onCollapseRow.call(this,b,c))}})}});
//# sourceMappingURL=datagrid-scrollview.min.js.map
