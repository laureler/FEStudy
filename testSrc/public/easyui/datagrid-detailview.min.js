$.extend($.fn.datagrid.defaults,{autoUpdateDetail:!0});var detailview=$.extend({},$.fn.datagrid.defaults.view,{render:function(a,b,d){var c=$.data(a,"datagrid"),e=c.options;if(!d||e.rownumbers||e.frozenColumns&&e.frozenColumns.length){var g=c.data.rows,f=$(a).datagrid("getColumnFields",d),h=[];h.push('\x3ctable class\x3d"datagrid-btable" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0"\x3e\x3ctbody\x3e');for(var k=0;k<g.length;k++){var m=e.rowStyler?e.rowStyler.call(a,k,g[k]):"",l="",n="";"string"==typeof m?n=m:m&&(l=m["class"]||"",n=m.style||"");h.push('\x3ctr id\x3d"'+(c.rowIdPrefix+"-"+(d?1:2)+"-"+k)+'" datagrid-row-index\x3d"'+k+'" '+('class\x3d"datagrid-row '+(k%2&&e.striped?"datagrid-row-alt ":" ")+l+'"')+" "+(n?'style\x3d"'+n+'"':"")+"\x3e");h.push(this.renderRow.call(this,a,f,d,k,g[k]));h.push("\x3c/tr\x3e");h.push('\x3ctr style\x3d"display:none;"\x3e');d?h.push("\x3ctd colspan\x3d"+(f.length+(e.rownumbers?1:0))+' style\x3d"border-right:0"\x3e'):h.push("\x3ctd colspan\x3d"+f.length+"\x3e");h.push('\x3cdiv class\x3d"datagrid-row-detail"\x3e');d?h.push("\x26nbsp;"):h.push(e.detailFormatter.call(a,k,g[k]));h.push("\x3c/div\x3e");h.push("\x3c/td\x3e");h.push("\x3c/tr\x3e")}h.push("\x3c/tbody\x3e\x3c/table\x3e");$(b).html(h.join(""))}},renderRow:function(a,b,d,c,e){var g=$.data(a,"datagrid").options,f=[];d&&g.rownumbers&&(d=c+1,g.pagination&&(d+=(g.pageNumber-1)*g.pageSize),f.push('\x3ctd class\x3d"datagrid-td-rownumber"\x3e\x3cdiv class\x3d"datagrid-cell-rownumber"\x3e'+d+"\x3c/div\x3e\x3c/td\x3e"));for(d=0;d<b.length;d++){var h=b[d],k=$(a).datagrid("getColumnOption",h);if(k){var m=e[h],l=k.styler?k.styler(m,e,c)||"":"",n="",p="";"string"==typeof l?p=l:f&&(n=l["class"]||"",p=l.style||"");l=k.hidden?'style\x3d"display:none;'+p+'"':p?'style\x3d"'+p+'"':"";f.push('\x3ctd field\x3d"'+h+'" '+(n?'class\x3d"'+n+'"':"")+" "+l+"\x3e");k.checkbox?l="":k.expander?l="text-align:center;height:16px;":(l=p,k.align&&(l+=";text-align:"+k.align+";"),g.nowrap?g.autoRowHeight&&(l+=";height:auto;"):l+=";white-space:normal;height:auto;");f.push('\x3cdiv style\x3d"'+l+'" ');k.checkbox?f.push('class\x3d"datagrid-cell-check '):f.push('class\x3d"datagrid-cell '+k.cellClass);f.push('"\x3e');k.checkbox?f.push('\x3cinput type\x3d"checkbox" name\x3d"'+h+'" value\x3d"'+(void 0!=m?m:"")+'"\x3e'):k.expander?f.push('\x3cspan class\x3d"datagrid-row-expander datagrid-row-expand" style\x3d"display:inline-block;width:16px;height:16px;cursor:pointer;" /\x3e'):k.formatter?f.push(k.formatter(m,e,c)):f.push(m);f.push("\x3c/div\x3e");f.push("\x3c/td\x3e")}}return f.join("")},insertRow:function(a,b,d){function c(f){var c=e.finder.getTr(a,b,"body",f?1:2);if(g){var h=c.next(),l=c.next().clone();c.insertAfter(h)}else l=c.next().next().clone();l.insertAfter(c);l.hide();f||l.find("div.datagrid-row-detail").html(e.detailFormatter.call(a,b,d))}var e=$.data(a,"datagrid").options;$.data(a,"datagrid");$(a).datagrid("getPanel");var g=!1,f=$(a).datagrid("getRows").length;if(0==f)$(a).datagrid("loadData",{total:1,rows:[d]});else{if(void 0==b||null==b||b>=f)b=f,g=!0,this.canUpdateDetail=!1;$.fn.datagrid.defaults.view.insertRow.call(this,a,b,d);c(!0);c(!1);this.canUpdateDetail=!0}},deleteRow:function(a,b){var d=$.data(a,"datagrid").options,c=$.data(a,"datagrid").dc;d.finder.getTr(a,b).next().remove();$.fn.datagrid.defaults.view.deleteRow.call(this,a,b);c.body2.triggerHandler("scroll")},updateRow:function(a,b,d){$.data(a,"datagrid");var c=$.data(a,"datagrid").options,e=$(a).datagrid("getExpander",b).attr("class");$.fn.datagrid.defaults.view.updateRow.call(this,a,b,d);$(a).datagrid("getExpander",b).attr("class",e);c.autoUpdateDetail&&this.canUpdateDetail&&(d=$(a).datagrid("getRows")[b],$(a).datagrid("getRowDetail",b).html(c.detailFormatter.call(a,b,d)))},bindEvents:function(a){var b=$.data(a,"datagrid");if(!b.ss.bindDetailEvents){b.ss.bindDetailEvents=!0;var b=b.dc,b=b.body1.add(b.body2),d=($.data(b[0],"events")||$._data(b[0],"events")).click[0].handler;b.unbind("click").bind("click",function(b){var c=$(b.target),g=c.closest("tr.datagrid-row");g.length&&(c.hasClass("datagrid-row-expander")?(g=parseInt(g.attr("datagrid-row-index")),c.hasClass("datagrid-row-expand")?$(a).datagrid("expandRow",g):$(a).datagrid("collapseRow",g),$(a).datagrid("fixRowHeight")):d(b),b.stopPropagation())})}},onBeforeRender:function(a){var b=$.data(a,"datagrid"),d=b.options,b=b.dc;a=$(a);for(var c=!1,e=a.datagrid("getColumnFields",!0).concat(a.datagrid("getColumnFields")),g=0;g<e.length;g++)if(a.datagrid("getColumnOption",e[g]).expander){c=!0;break}c||(d.frozenColumns&&d.frozenColumns.length?d.frozenColumns[0].splice(0,0,{field:"_expander",expander:!0,width:24,resizable:!1,fixed:!0}):d.frozenColumns=[[{field:"_expander",expander:!0,width:24,resizable:!1,fixed:!0}]],a=b.view1.children("div.datagrid-header").find("table"),b=$('\x3ctd rowspan\x3d"'+d.frozenColumns.length+'"\x3e\x3cdiv class\x3d"datagrid-header-expander" style\x3d"width:24px;"\x3e\x3c/div\x3e\x3c/td\x3e'),0==$("tr",a).length?b.wrap("\x3ctr\x3e\x3c/tr\x3e").parent().appendTo($("tbody",a)):d.rownumbers?b.insertAfter(a.find("td:has(div.datagrid-header-rownumber)")):b.prependTo(a.find("tr:first")))},onAfterRender:function(a){function b(){var a=c.body2.find("\x3etable.datagrid-btable\x3etbody\x3etr\x3etd\x3ediv.datagrid-row-detail:visible");if(a.length){var b=0;c.header2.find(".datagrid-header-check:visible,.datagrid-cell:visible").each(function(){b+=$(this).outerWidth(!0)+1});b!=a.outerWidth(!0)&&(a._outerWidth(b),a.find(".easyui-fluid").trigger("_resize"))}}var d=$.data(a,"datagrid"),c=d.dc,e=d.options,g=$(a).datagrid("getPanel");$.fn.datagrid.defaults.view.onAfterRender.call(this,a);d.onResizeColumn||(d.onResizeColumn=e.onResizeColumn,e.onResizeColumn=function(f,c){e.fitColumns||b();for(var g=$(a).datagrid("getRows").length,h=0;h<g;h++)$(a).datagrid("fixDetailRowHeight",h);d.onResizeColumn.call(a,f,c)});d.onResize||(d.onResize=e.onResize,e.onResize=function(a,c){e.fitColumns&&b();d.onResize.call(g,a,c)});this.canUpdateDetail=!0;c.footer1.add(c.footer2).find("span.datagrid-row-expander").css("visibility","hidden");$(a).datagrid("resize");this.bindEvents(a);c.body1.add(c.body2).find("div.datagrid-row-detail").unbind().bind("mouseover mouseout click dblclick contextmenu scroll",function(a){a.stopPropagation()})}});$.extend($.fn.datagrid.methods,{fixDetailRowHeight:function(a,b){return a.each(function(){var a=$.data(this,"datagrid").options;if(a.rownumbers||a.frozenColumns&&a.frozenColumns.length){var c=$.data(this,"datagrid").dc,e=a.finder.getTr(this,b,"body",1).next(),a=a.finder.getTr(this,b,"body",2).next();if(a.is(":visible")){e.css("height","");a.css("height","");var g=Math.max(e.height(),a.height());e.css("height",g);a.css("height",g)}c.body2.triggerHandler("scroll")}})},getExpander:function(a,b){return $.data(a[0],"datagrid").options.finder.getTr(a[0],b).find("span.datagrid-row-expander")},getRowDetail:function(a,b){return $.data(a[0],"datagrid").options.finder.getTr(a[0],b,"body",2).next().find("\x3etd\x3ediv.datagrid-row-detail")},expandRow:function(a,b){return a.each(function(){var a=$(this).datagrid("options");$.data(this,"datagrid");var c=$(this).datagrid("getExpander",b);if(c.hasClass("datagrid-row-expand")){c.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");var c=a.finder.getTr(this,b,"body",1).next(),e=a.finder.getTr(this,b,"body",2).next();c.show();e.show();$(this).datagrid("fixDetailRowHeight",b);a.onExpandRow&&(c=$(this).datagrid("getRows")[b],a.onExpandRow.call(this,b,c))}})},collapseRow:function(a,b){return a.each(function(){var a=$(this).datagrid("options"),c=$.data(this,"datagrid").dc,e=$(this).datagrid("getExpander",b);if(e.hasClass("datagrid-row-collapse")){e.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");var e=a.finder.getTr(this,b,"body",1).next(),g=a.finder.getTr(this,b,"body",2).next();e.hide();g.hide();c.body2.triggerHandler("scroll");a.onCollapseRow&&(c=$(this).datagrid("getRows")[b],a.onCollapseRow.call(this,b,c))}})}});$.extend($.fn.datagrid.methods,{subgrid:function(a,b){return a.each(function(){function a(b,f,d){var g=$.extend({},f.options.queryParams||{});if(d){var h=f.options.foreignField;$.isFunction(h)?$.extend(g,h.call(f,d)):g[h]=d[h]}d=f.options.edatagrid?"edatagrid":"datagrid";$(b)[d]($.extend({},f.options,{subgrid:f.subgrid,view:f.subgrid?detailview:void 0,queryParams:g,detailFormatter:function(a,b){return'\x3cdiv\x3e\x3ctable class\x3d"datagrid-subgrid"\x3e\x3c/table\x3e\x3c/div\x3e'},onExpandRow:function(b,c){var d=$(this).datagrid("options"),g=$(this).datagrid("getRowDetail",b),h;h=$(g).children("div");h=h.children("div.datagrid").length?h.find("\x3ediv.datagrid\x3ediv.panel-body\x3ediv.datagrid-view\x3etable.datagrid-subgrid"):h.find("\x3etable.datagrid-subgrid");h.data("datagrid")||a(h[0],d.subgrid,c);g.find(".easyui-fluid").trigger("_resize");e(this,b);f.options.onExpandRow&&f.options.onExpandRow.call(this,b,c)},onCollapseRow:function(a,b){e(this,a);f.options.onCollapseRow&&f.options.onCollapseRow.call(this,a,b)},onResize:function(){$(this).children("div.datagrid-view").children("table");c(this)},onResizeColumn:function(a,b){c(this);f.options.onResizeColumn&&f.options.onResizeColumn.call(this,a,b)},onLoadSuccess:function(a){c(this);f.options.onLoadSuccess&&f.options.onLoadSuccess.call(this,a)}}))}function c(a){var b=$(a).closest("div.datagrid-row-detail").closest("tr").prev();b.length&&(a=parseInt(b.attr("datagrid-row-index")),b=b.closest("div.datagrid-view").children("table"),e(b[0],a))}function e(a,b){$(a).datagrid("fixDetailRowHeight",b);$(a).datagrid("fixRowHeight",b);var c=$(a).closest("div.datagrid-row-detail").closest("tr").prev();c.length&&(b=parseInt(c.attr("datagrid-row-index")),c=c.closest("div.datagrid-view").children("table"),e(c[0],b))}a(this,b)})},getSelfGrid:function(a){a=a.closest(".datagrid");return a.length?a.find("\x3e.datagrid-wrap\x3e.datagrid-view\x3e.datagrid-f"):null},getParentGrid:function(a){a=a.closest("div.datagrid-row-detail");return a.length?a.closest(".datagrid-view").children(".datagrid-f"):null},getParentRowIndex:function(a){a=a.closest("div.datagrid-row-detail");return a.length?(a=a.closest("tr").prev(),parseInt(a.attr("datagrid-row-index"))):-1}});
//# sourceMappingURL=datagrid-detailview.min.js.map
