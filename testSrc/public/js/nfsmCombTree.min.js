// 全部调用的引用都可以持有
(function(u){$.fn.nsCombTreeChange=function(p){nfsmCombTree.setChangeFunById(this[0].id,p)};u.nfsmCombTree=new function(){function p(a){var e=null;"string"==typeof a&&(e=n.get(a)||null);a&&1==a.nodeType&&(a=$(a));a&&a instanceof jQuery&&(a.eq(0).attr("id")&&n.get(a.eq(0).attr("id"))?e=n.get(a.eq(0).attr("id")):a.parents(".nfsm-combTree")&&n.get(a.parents(".nfsm-combTree").attr("id"))&&(e=n.get(a.parents(".nfsm-combTree").attr("id"))));return e}var n=new Map,r=new Map,t=new Map,l=[];this.pushInitTree=function(a){l.push(a)};this.onloadInit=function(a){loadControl.addEvent(null,function(){for(var a=0,c=l.length;a<c;a++)nfsmCombTree.initTree(l[a]);l.length=0})};this.batchInit=function(){for(var a=0,e=l.length;a<e;a++)nfsmCombTree.initTree(l[a]);l.length=0};this.showTree=function(a){var e=$(a.target),c;c=e.hasClass("nfsm-combTree")?e:e.parent();if(c.find(".ct-list-showCheck").attr("disabled")||e.hasClass("ct-input")&&!e[0].readOnly)return!1;e.is("I")?nfsmCombTree.getInstance(c)?nfsmCombTree.getInstance(c).clean():"":(nfsmCombTree.initTree(c.attr("id")),a=null,e.hasClass("ct-list-showCheck")&&(a=!e[0].checked),e=c.find(".ct-list-showCheck").eq(0),c.find(".ct-list-showCheck").eq(0),null===a?a=e[0].checked:"",$(".ct-list").css("display","none"),$(".ct-list-showCheck").attr("checked",!1),c=c.parents(".ui-widget-content"),c=0<c.length?c.eq(0):null,a?(c?c.css("z-index",c.eq(0).attr("data-z-index")):"",e[0].checked=!1):(c?c.attr("data-z-index",c.css("z-index")).css("z-index",100):"",e[0].checked=!0))};this.initTree=function(a,e){var c={},k=nfsmCombTree.getInstance(a,e);if(!k){for(var k=$(document.getElementById(a)),l=null!=k.attr("data-option")?k.attr("data-option").split(","):[],q=0,h=l.length;q<h;q++){var g=l[q].split(":");g[0]&&g[1]?c[g[0]]=g[1]:""}null!=k.attr("data-showPanel")?c.showPanel=k.attr("data-showPanel"):"";nfsmCombTree.init(a,c);(c=nfsmCombTree.getDataByEleId(a))&&0<c.data.length?setMultiSelectValue(a,c.data,c.val):""}return k=nfsmCombTree.getInstance(a,e)};this.getDataByEleId=function(a){return r.get(a)};this.setDataByEleId=function(a,e,c){r.set(a,{data:e,val:c})};this.setChangeFunById=function(a,e){t.set(a,e)};this.getChangeFunById=function(a){return t.get(a)};this.closeTree=function(){document.addEventListener("click",function(a){if(0<$(a.target).parent(".nfsm-combTree").length)return!1;$(".ct-list").css("display","none");$(".ct-list-showCheck").attr("checked",!1)})};this.validataFun=function(a,e){var c=$(a);e?(c.attr("data-mes",e),c.addClass("textbox-invalid-important"),c.nsTooltip("show")):(c.removeClass("textbox-invalid-important"),c.nsTooltip("remove"))};this.getInstance=function(a,e){var c=p(a);e||c&&c.getShowPanel&&eval(c.getShowPanel());return c};this.getInstanceEval=function(a){return p(a)};this.init=function(a,e){function c(a,e){var h=this,g=null;new Map;var d={url:e.url||"",data:e.data||nfsmCombTree.getDataByEleId(a)||[],checkbox:"",isSingle:"",checkNodeByKey:{},checkNodeByText:{},rsVal:{},rootDatas:[],required:e.required?e.required.trim():"",showPanel:e.showPanel,styleId:"",screenType:0};h.getShowPanel=function(){return d.showPanel||null};d.bindEvent=function(){g.find(".ct-input").eq(0).bind({keyup:function(b){$(b.target).val()?g.find(".ct-clean").show():g.find(".ct-clean").hide();var a=$(b.target).val();if(a){var m=d.isSingle?[a]:a.split(",");h.clean(1);for(var c=0,e=m.length;c<e;c++)d.checkedDeal(m[c],0,!0,1);d.isSingle&&$(b.target).val(a)}f(b.target);return!1},change:function(b){f(b.target)}});var f=function(b){var f=[],a;for(a in d.rsVal)d.rsVal[a]&&d.rsVal[a].key&&f.push(d.rsVal[a].text);f=f.join(",");$(b).val()?g.find(".ct-clean").show():g.find(".ct-clean").hide();a=nfsmCombTree.getChangeFunById(g.attr("id"));d.required&&($(b).val()?nfsmCombTree.validataFun($(b)):nfsmCombTree.validataFun($(b),"\u8be5\u8f93\u5165\u9879\u4e3a\u5fc5\u8f93\u5165\u9879"));null!=a?void 0==$(b).attr("data-oldValue")?($(b).attr("data-oldValue",f),a()):$(b).attr("data-oldValue")!=f&&($(b).attr("data-oldValue",f),a()):$(b).val()&&nfsmCombTree.validataFun($(b));$(b).nsTooltip("focus")};g.find(".node-content\x3ediv").click(function(b){g.removeAttr("none-trigger");b=b.target;if("I"==b.tagName&&0<=b.className.indexOf("icon-expand"))return b=$(b).parent().next(),b.hasClass("disp-none")?b.removeClass("disp-none"):b.addClass("disp-none"),!1;if("INPUT"==b.tagName&&0<=b.className.indexOf("node-check"))return d.checkedDeal(b.value.split(",")[1],1,b.checked),g.find(".ct-input").change(),!1;b=$(this).find(".node-check")[0];d.checkedDeal(b.value.split(",")[1],1,!b.checked);g.find(".ct-input").change();return!1})};h.loadData=function(f){function b(f,g){g++;for(var e=0;e<f.length;e++){var m=null!=f[e].children&&0<f[e].children.length?!0:!1;c+='\x3cli class\x3d"tree-node"\x3e\x3cdiv class\x3d"node-content'+(m?"":" node-leaf")+'" data-filter\x3d"'+f[e].id+'"data-filterT\x3d"'+f[e].text+'"\x3e\x3cdiv\x3e';for(var h=0;h<g;h++)c+='\x3ci class\x3d"node-icon node-occupy"\x3e\x3c/i\x3e';c+='\x3ci class\x3d"node-icon '+(m?"icon-expand":"")+'"\x3e\x3c/i\x3e\x3ci class\x3d"node-icon '+(m?"icon-folder":"icon-file")+'"\x3e\x3c/i\x3e';c+='\x3cinput class\x3d"node-check '+(d.checkbox?"":" disp-none")+' " type\x3d"checkbox" value\x3d"'+a+","+f[e].id+","+f[e].text+'"\x3e';c+='\x3cspan class\x3d"node-text"\x3e'+f[e].text+"\x3c/span\x3e\x3c/div\x3e";d.rootDatas.push(f[e]);a++;m&&(c+='\x3cul class\x3d"tree"\x3e',b(f[e].children,g),c+="\x3c/ul\x3e");c+="\x3c/div\x3e\x3c/li\x3e"}}var a=0,c='\x3cul class\x3d"tree" style\x3d"width: fit-content;min-width:100%;"\x3e';b(f,-1);c+="\x3c/ul\x3e";g.find(".nfsm-ct-cont").html(c);d.storageCheckNode();d.setCombox();d.bindEvent()};d.setCombList=function(){$.ajax({url:d.url,dataType:"json",method:"GET",async:!1,success:function(f){h.loadData(f)}})};d.closeCbTree=function(){g.attr("none-trigger")?g.removeAttr("none-trigger"):g.find(".ct-list-showCheck").trigger("click")};d.configDeal=function(f,b){g=null!=f?$(document.getElementById(f)):null;"false"==b.checkbox||""==b.checkbox?d.checkbox=!1:d.checkbox="true";d.isSingle=!d.checkbox};d.storageCheckNode=function(){for(var f=g.find(".node-check"),b=0,a=f.length;b<a;b++){var c=f[b].value.split(",");d.checkNodeByKey[c[1]]=f[b];d.checkNodeByText[c[2]]=f[b]}};d.setCombox=function(){g.find(".ct-clean").click(function(f){h.clean();g.find(".ct-input")[0].focus();g.find(".ct-input").change()})};d.init=function(f,b){d.configDeal(f,b);d.data.data&&0<d.data.data.length?h.loadData(d.data):d.url&&d.setCombList()};d.init(a,e);h.clean=function(f){f?"":g.find(".ct-input").val("");f=g.find(".bgc-88c3d5");if(0<f.length)for(var b=0,a=f.length;b<a;b++)f[b].classList.remove("bgc-88c3d5");g.find(".node-check").attr("checked",!1);d.rsVal={}};h.cleanData=function(){h.clean();g.find(".ct-input").change()};d.checkedDeal=function(f,b,a,c){if(-1==b){if((b=d.checkNodeByKey[f])||(b=d.checkNodeByText[f]),!b)return a=g.find(".ct-input"),c=a.val()+","+f,a.val(0==c.indexOf(",")?c.substr(1):c),!1}else if(b=b?d.checkNodeByKey[f]:d.checkNodeByText[f],!b)return!1;if(d.isSingle){d.closeCbTree();if(g.find(".bgc-88c3d5")[0]==$(b).parent("div")[0])return;h.clean()}d.checkbox||(d.isSingle&&(0<g.find(".bgc-88c3d5").length?g.find(".bgc-88c3d5")[0].classList.remove("bgc-88c3d5"):""),a?$(b).parent("div").addClass("bgc-88c3d5"):$(b).parent("div").removeClass("bgc-88c3d5"));f=b.value.split(",")[1];var e=b.value.split(",")[2];(b.checked=a)?c?d.addRsVal(f,e):d.addVal(f,e):c?d.delRsVal(f,e):d.delVal(f,e)};d.addVal=function(f,b){var a=g.find(".ct-input"),c=a.val()+","+b;a.val(0==c.indexOf(",")?c.substr(1):c);d.addRsVal(f,b)};d.addRsVal=function(a,b){d.isSingle&&(d.rsVal={});d.rsVal[a]={key:a,text:b}};d.delVal=function(a,b){var f=g.find(".ct-input"),c=(","+f.val()).split(","+b).join("");f.val(0==c.indexOf(",")?c.substr(1):c);d.delRsVal(a,b)};d.delRsVal=function(a,b){d.isSingle&&(d.rsVal={});d.rsVal[a]={}};h.getResourceData=function(){return this.data};h.getRootDatas=function(){return d.rootDatas};d.deleteCheck=function(a){var b=g.find(".ct-input");a=(","+b.val()).split(","+a).join("");b.val(a.substr(1))};h.getText=function(){return g?g.find(".ct-input").val():""};h.setText=function(a){var b=g.find(".ct-input");a=d.isSingle?a:b.val()+","+a;b.val(a);0==b.val().indexOf(",")&&(a=b.val().substr(1),b.val(a));h.clean();b.change()};h.getValue=function(){var a=[],b;for(b in d.rsVal)d.rsVal[b]&&d.rsVal[b].key&&a.push(d.rsVal[b].key);return a.length?a.join(","):g?g.find(".ct-input").val():""};h.setValue=function(a,b){var c="string"==typeof a?a.split(","):a;h.clean();g.attr("none-trigger",1);if(0>=c.length)return!1;for(var f=0,e=c.length;f<e;f++)d.checkedDeal(c[f],-1,!0);g.find(".ct-input").change()};h.screen=function(a,b){b?"":b=1;if("1"==d.screenType){if(/^[ ]+$/.test(a)||""==a)return g.find(".node-content").removeClass("disp-none"),!1;g.find(".node-content").addClass("disp-none");b?g.find(".node-content[data-filter*\x3d'"+a+"']").removeClass("disp-none"):g.find(".node-content[data-filterT*\x3d'"+a+"']").removeClass("disp-none");for(var c=g.find(".node-content:not(.disp-none)"),e=0,f=c.length;e<f;e++)$(c[e]).parents(".node-content").removeClass("disp-none");return!1}if(/^[ ]+$/.test(a)||""==a)return g.find(".node-content\x3ediv").removeClass("disp-none"),!1;g.find(".node-content\x3ediv").addClass("disp-none");b?(g.find(".node-content[data-filter*\x3d'"+a+"']\x3ediv").removeClass("disp-none"),g.find(".node-content[data-filter\x3d'"+a+"']\x3ediv").addClass("disp-none")):(g.find(".node-content[data-filterT*\x3d'"+a+"']\x3ediv").removeClass("disp-none"),g.find(".node-content[data-filterT\x3d'"+a+"']\x3ediv").addClass("disp-none"))};c.prototype={version1:"1.0"};return h}var k=null,k=new c(a,e);n.set(a,k);return k};return this}})(window);nfsmCombTree.onloadInit();nfsmCombTree.closeTree();
//# sourceMappingURL=nfsmCombTree.min.js.map
