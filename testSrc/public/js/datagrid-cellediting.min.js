(function(e){function m(a,b){var c=e(this),d=c.datagrid("cell");if(!c.datagrid("input",d))return c.datagrid("gotoCell",b),!1}function r(a){a=e(this);var b=a.datagrid("cell");if(b&&!a.datagrid("input",b))return a.datagrid("editCell",{index:b.index,field:b.field,value:""}),!1}function t(a,b){var c=e(a).datagrid("options");c.finder.getTr(a,b.index).find('td[field\x3d"'+b.field+'"]').removeClass("datagrid-row-selected");c.onUnselectCell.call(a,b.index,b.field)}function q(a){e(a).datagrid("getPanel").find("td.datagrid-row-selected").removeClass("datagrid-row-selected")}function n(a,b){var c=e(a).datagrid("options");c.singleSelect&&q(a);c.finder.getTr(a,b.index).find('td[field\x3d"'+b.field+'"]').addClass("datagrid-row-selected");c.onSelectCell.call(a,b.index,b.field)}function u(a){var b=[];e(a).datagrid("getPanel").find("td.datagrid-row-selected").each(function(){var a=e(this);b.push({index:parseInt(a.closest("tr.datagrid-row").attr("datagrid-row-index")),field:a.attr("field")})});return b}function v(a,b){function c(c){d.datagrid("scrollTo",c.index);q(a);n(a,c);c=g.finder.getTr(a,c.index,"body",2).find('td[field\x3d"'+c.field+'"]');if(c.length){var b=d.data("datagrid").dc.body2,f=c.position().left;0>f?b._scrollLeft(b._scrollLeft()+f*(g.isRtl?-1:1)):f+c._outerWidth()>b.width()&&b._scrollLeft(b._scrollLeft()+(f+c._outerWidth()-b.width())*(g.isRtl?-1:1))}}var d=e(a),g=d.datagrid("options"),h=d.datagrid("getPanel").focus(),f=d.datagrid("cell");if(f&&(f=d.datagrid("input",f))){f.focus();return}if("object"==typeof b)c(b);else if(f=h.find("td.datagrid-row-selected")){var h=d.datagrid("getColumnFields",!0).concat(d.datagrid("getColumnFields")),k=f.attr("field"),f=f.closest("tr.datagrid-row"),f=parseInt(f.attr("datagrid-row-index")),k=e.inArray(k,h);if("up"==b&&0<f)f--;else if("down"==b&&f<d.datagrid("getRows").length-1)f++;else if("left"==b)for(var l=k-1;0<=l;){var m=d.datagrid("getColumnOption",h[l]);if(!m.hidden){k=l;break}l--}else if("right"==b)for(l=k+1;l<=h.length-1;){m=d.datagrid("getColumnOption",h[l]);if(!m.hidden){k=l;break}l++}k=h[k];c({index:f,field:k})}}function p(a,b){var c=e(a),d=c.datagrid("cell");if(d){var g=c.datagrid("input",d);if(g)if(b)if(c.datagrid("validateRow",d.index))c.datagrid("endEdit",d.index),c.datagrid("gotoCell",d);else return c.datagrid("gotoCell",d),g.focus(),!1;else c.datagrid("cancelEdit",d.index),c.datagrid("gotoCell",d)}return!0}function w(a,b){var c=e(a),d=c.datagrid("options"),g=c.datagrid("input",b);if(g)c.datagrid("gotoCell",b),g.focus();else if(p(a,!0)&&0!=d.onBeforeCellEdit.call(a,b.index,b.field)){var h=c.datagrid("getColumnFields",!0).concat(c.datagrid("getColumnFields"));e.map(h,function(a){var f=c.datagrid("getColumnOption",a);f.editor1=f.editor;a!=b.field&&(f.editor=null)});c.datagrid("getColumnOption",b.field).editor?(c.datagrid("beginEdit",b.index),(g=c.datagrid("input",b))?(c.datagrid("gotoCell",b),setTimeout(function(){g.focus()},0),d.onCellEdit.call(a,b.index,b.field,b.value)):(c.datagrid("cancelEdit",b.index),c.datagrid("gotoCell",b))):c.datagrid("gotoCell",b);e.map(h,function(a){a=c.datagrid("getColumnOption",a);a.editor=a.editor1})}}function x(a){var b=e(a),c=b.data("datagrid"),d=b.datagrid("getPanel"),g=c.options,c=c.dc;d.attr("tabindex",1).css("outline-style","none").unbind(".cellediting").bind("keydown.cellediting",function(c){var b=g.navHandler[c.keyCode];if(b)return b.call(a,c)});c.body1.add(c.body2).unbind(".cellediting").bind("click.cellediting",function(c){var b=e(c.target).closest(".datagrid-row");if(b.length&&b.parent().length){var d=e(c.target).closest("td[field]",b);if(d.length){var b=parseInt(b.attr("datagrid-row-index")),h=d.attr("field"),b={index:b,field:h};g.singleSelect?n(a,b):g.ctrlSelect?c.ctrlKey?d.hasClass("datagrid-row-selected")?t(a,b):n(a,b):(q(a),n(a,b)):d.hasClass("datagrid-row-selected")?t(a,b):n(a,b)}}});g.isRtl="rtl"==b.datagrid("getPanel").css("direction").toLowerCase();g.OldOnBeforeSelect=g.onBeforeSelect;g.onBeforeSelect=function(){return!1};b.datagrid("clearSelections")}function y(a){var b=e(a),c=b.datagrid("options"),d=b.datagrid("getPanel");d.attr("tabindex",1).css("outline-style","none").unbind(".cellediting").bind("keydown.cellediting",function(b){var d=c.navHandler[b.keyCode];if(d)return d.call(a,b)}).bind("keypress.cellediting",function(b){return c.navHandler.keypress.call(a,b)});d.panel("panel").unbind(".cellediting").bind("keydown.cellediting",function(a){a.stopPropagation()}).bind("keypress.cellediting",function(a){a.stopPropagation()});c.isRtl="rtl"==b.datagrid("getPanel").css("direction").toLowerCase();c.oldOnClickCell=c.onClickCell;c.oldOnDblClickCell=c.onDblClickCell;c.onClickCell=function(a,b,d){c.clickToEdit?e(this).datagrid("editCell",{index:a,field:b}):p(this,!0)&&e(this).datagrid("gotoCell",{index:a,field:b});c.oldOnClickCell.call(this,a,b,d)};c.dblclickToEdit&&(c.onDblClickCell=function(a,b,d){e(this).datagrid("editCell",{index:a,field:b});c.oldOnDblClickCell.call(this,a,b,d)});c.OldOnBeforeSelect=c.onBeforeSelect;c.onBeforeSelect=function(){return!1};b.datagrid("clearSelections")}e.extend(e.fn.datagrid.defaults,{clickToEdit:!0,dblclickToEdit:!1,navHandler:{37:function(a){var b=e(this).datagrid("options");return m.call(this,a,b.isRtl?"right":"left")},39:function(a){var b=e(this).datagrid("options");return m.call(this,a,b.isRtl?"left":"right")},38:function(a){return m.call(this,a,"up")},40:function(a){return m.call(this,a,"down")},13:function(a){a=e(this);var b=a.datagrid("cell");b?(a.datagrid("input",b)?p(this,!0):a.datagrid("editCell",b),a=!1):a=void 0;return a},27:function(a){p(this,!1);return!1},8:function(a){return r.call(this,a)},46:function(a){return r.call(this,a)},keypress:function(a){if(!a.metaKey&&!a.ctrlKey){var b=e(this),c=b.datagrid("cell");if(c&&!b.datagrid("input",c)){var d=e("\x3cspan\x3e\x3c/span\x3e");d.html(String.fromCharCode(a.which));a=d.text();d.remove();if(a)return b.datagrid("editCell",{index:c.index,field:c.field,value:a}),!1}}}},onBeforeCellEdit:function(a,b){},onCellEdit:function(a,b,c){(a=e(this).datagrid("input",{index:a,field:b}))&&void 0!=c&&a.val(c)},onSelectCell:function(a,b){},onUnselectCell:function(a,b){}});e.extend(e.fn.datagrid.methods,{editCell:function(a,b){return a.each(function(){w(this,b)})},isEditing:function(a,b){var c=e.data(a[0],"datagrid").options.finder.getTr(a[0],b);return c.length&&c.hasClass("datagrid-row-editing")},gotoCell:function(a,b){return a.each(function(){v(this,b)})},enableCellEditing:function(a){return a.each(function(){y(this)})},disableCellEditing:function(a){return a.each(function(){var a=e(this),c=a.datagrid("options");c.onClickCell=c.oldOnClickCell||c.onClickCell;c.onDblClickCell=c.oldOnDblClickCell||c.onDblClickCell;c.onBeforeSelect=c.OldOnBeforeSelect||c.onBeforeSelect;a.datagrid("getPanel").unbind(".cellediting").find("td.datagrid-row-selected").removeClass("datagrid-row-selected")})},enableCellSelecting:function(a){return a.each(function(){x(this)})},disableCellSelecting:function(a){return a.each(function(){var a=e(this),c=a.data("datagrid"),a=a.datagrid("getPanel"),d=c.options;d.onBeforeSelect=d.OldOnBeforeSelect||d.onBeforeSelect;a.unbind(".cellediting").find("td.datagrid-row-selected").removeClass("datagrid-row-selected");c=c.dc;c.body1.add(c.body2).unbind("cellediting")})},input:function(a,b){if(!b)return null;var c=a.datagrid("getEditor",b);return c?(c=e(c.target),c.hasClass("textbox-f")&&(c=c.textbox("textbox")),c):null},cell:function(a){a=e(a[0]).datagrid("getPanel").find("td.datagrid-row-selected");a=a.length?{index:parseInt(a.closest("tr.datagrid-row").attr("datagrid-row-index")),field:a.attr("field")}:null;return a},getSelectedCells:function(a){return u(a[0])}})})(jQuery);
//# sourceMappingURL=datagrid-cellediting.min.js.map
