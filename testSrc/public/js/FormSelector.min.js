/**
 * 表单选择器的方法
*/

//获取表单html内容的服务地址
var renderFormUrl="/formengineWebService/renderSelectForm?formid\x3d",getFormDomainUrl="/formengineWebService/getFormControlList?type\x3d1\x26forminforid\x3d",cacheFormid7811q="";function ShowFormSelector(a,b,e,c){var d=this;if(a){var f="",f=(c?f+'\x3cdiv id\x3d"formSelector7811q" style\x3d"width:100%;height:100%;"\x3e':f+'\x3cdiv id\x3d"formSelector7811qBox"\x3e\x3cdiv id\x3d"formSelector7811q" class\x3d"easyui-window" title\x3d"\u8868\u5355\u9009\u62e9\u5668" data-options\x3d"collapsible:false,minimizable:false,modal:true,maximized:true,footer:\'#dlg-footer-btns7811q\'" style\x3d"width:870px;height:600px;"\x3e')+'\x3cdiv class\x3d"easyui-layout" data-options\x3d"fit:true,border:\'none\'" style\x3d"height:100%;"\x3e\x3cdiv data-options\x3d"region:\'center\'" style\x3d"width:400px;height:450px;overflow:hidden;position:relative;"\x3e\x3cdiv class\x3d"shadeMask" style\x3d"display:block;background-color:#E4F8E8"\x3e\x3cdiv class\x3d"loadingTxt"\x3e\u6b63\u5728\u521d\u59cb\u5316\u8868\u5355...\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"curFormInfoHeadBox"\x3e\x3cul id\x3d"curFormInfoHead7811q" class\x3d"curFormInfoHead"\x3e\x3cli fname\x3d"" class\x3d"fs_item sel" onclick\x3d"renderIframe7811q(this)"\x3e\u4e3b\u8868\u5355\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3cdiv id\x3d"curFormInfoCont7811q" class\x3d"iframeBox"\x3e\x3ciframe id\x3d"mainifr7811q" class\x3d"formselector-iframe" name\x3d""\x3e\x3c/iframe\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"fselector-list" title\x3d"\u6240\u6709\u63a7\u4ef6" data-options\x3d"region:\'east\',split:true,width:350" style\x3d"min-width:262px;height:100%;"\x3e\x3cdiv style\x3d"margin-right:-1px;"\x3e\x3cinput class\x3d"easyui-searchbox" data-options\x3d"prompt:\'\u67e5\u627e\u63a7\u4ef6\',searcher:SearchKongjian7811q" style\x3d"width:100%;height:30px;" /\x3e\x3c/div\x3e\x3cdiv style\x3d"position:absolute;bottom:0;top:58px;width:100%;overflow-x:visible;overflow-y:auto;"\x3e\x3cul id\x3d"formselectorul7811q" class\x3d"easyui-tree"\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',f=c?f+"\x3c/div\x3e":f+'\x3cdiv id\x3d"dlg-footer-btns7811q" style\x3d"line-height:35px;height:35px;text-align:center;"\x3e\x3ca class\x3d"easyui-linkbutton" style\x3d"margin:0 10px;" data-options\x3d"iconCls:\'icon-ibase_quanclear\',plain:true" onclick\x3d"formFieldSelectMode(1)"\x3e\u6e05\u9664\u52fe\u9009\x3c/a\x3e\x26nbsp;\x3ca class\x3d"easyui-linkbutton" style\x3d"margin:0 30px;" data-options\x3d"iconCls:\'icon-ok\'" onclick\x3d"submitFormSelector()"\x3e\u786e\x26nbsp;\x26nbsp;\u5b9a\x3c/a\x3e\x26nbsp;\x3ca class\x3d"easyui-linkbutton" data-options\x3d"iconCls:\'icon-cancel\'" onclick\x3d"$(\'#formSelector7811q\').window(\'close\')"\x3e\u53d6\x26nbsp;\x26nbsp;\u6d88\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',g=a+""+c;cacheFormid7811q!=g||0==$("#formSelector7811q").length?(cacheFormid7811q=g,0<$("#formSelector7811qBox").length?($("#formSelector7811q").window("destroy"),$("#formSelector7811qBox").remove()):0<$("#formSelector7811q").length&&$("#formSelector7811q").remove(),c?($("#"+c).html(f),$.parser.parse("#"+c)):($("body").append(f),$.parser.parse("#formSelector7811qBox")),$.ajax({url:getFormDomainUrl+a,type:"GET",async:!1,dataType:"json",success:function(a){$("#formselectorul7811q").tree({data:a,animate:!0,checkbox:function(a){return a.id&&"#"!=a.id.charAt(0)},cascadeCheck:!1,formatter:function(a){if(!a.attributes.ftype)return a.text;var b=a.text;0<=b.indexOf("\x3c")&&(b=htmlEncode(b));var d=a.id,c=d.lastIndexOf("\x3e");0<=c&&(d=d.substr(c+1));return b+"-\x3cspan style\x3d'color:red;'\x3e"+d+"\x3c/span\x3e("+a.attributes.ftype+")"},onCheck:function(a){d.onCheckNode(a)},onLoadSuccess:function(a,b){$("#formselectorul7811q").on("mouseenter","span.tree-title",function(){var a=$(this).parents(".window").css("z-index")+100,b=$(this).text(),d=$(this).width()+4,c=$(this).position().left,e=$("#formselectorul7811q").width();d+c>e&&0==$("body").find(".tip").length&&(b='\x3cdiv class\x3d"tip"\x3e'+b+"\x3c/div\x3e",$("body").append(b),$(".tip").css({top:$(this).offset().top+20,left:$(this).offset().left-100,"z-index":a}))});$("#formselectorul7811q").on("mouseleave","span.tree-title",function(){0!=$("body").find(".tip").length&&$("body").find(".tip").remove()})}})},error:function(a,b,d){console.log("\u83b7\u53d6\u670d\u52a1\u5668\u6570\u636e\u5931\u8d25\uff01")}}),$("#mainifr7811q").attr("src",renderFormUrl+a),bindSFormCont7811q(b,"mainifr7811q","")):(c||$("#formSelector7811q").window("open"),resetSelected7811q(b,"mainifr7811q"));this.onCheckNode=function(a){var b=a.id,d=b.lastIndexOf("\x3e"),c="";0<=d&&(c=b.substr(0,d),b=b.substr(d+1));d="mainifr7811q";c&&(d=toIdEncode(c)+"7811q");a=a.checked;c=null;d=$("#"+d);0<d.length&&(c=d.contents().find("div[cnode\x3dshell]").filter('div[fname\x3d"'+b+'"]').eq(0));c&&0<c.length&&(a?(c.find(".maskbox").css("opacity","0.8"),c.attr("isSelect","select")):(c.find(".maskbox").css("opacity","0.1"),c.attr("isSelect","noselect")))};this.submitFormSelector=function(){var a=GetSelectedFormFields();c||$("#formSelector7811q").window("close");e&&e(a)}}else showError("\u8868\u5355ID\u4e0d\u80fd\u4e3a\u7a7a")}function SearchKongjian7811q(a){searchTreeNode($("#formselectorul7811q"),a,!0)}function FSelectorOpenSubForm7811q(a,b,e){if(a){if(0==$("#curFormInfoCont7811q").children('iframe[name\x3d"'+b+'"]').length){var c=toIdEncode(b)+"7811q";a='\x3ciframe id\x3d"'+c+'" class\x3d"formselector-iframe" name\x3d"'+b+'" src\x3d"'+("/formengineWebService/renderSelectForm?formid\x3d"+a)+'"\x3e\x3c/iframe\x3e';var d=getSubFormTitle7811q(b),d='\x3cli fname\x3d"'+b+'" class\x3d"fs_item sel" onclick\x3d"renderIframe7811q(this)"\x3e'+d+'\x3cdiv class\x3d"icon-ibase-closeX" onclick\x3d"closeSubForm7811q(this)"\x3e\x3c/div\x3e\x3c/li\x3e';$("#curFormInfoCont7811q").children().css({display:"none"}).end().append(a);$("#curFormInfoHead7811q").children().removeClass("sel").end().append(d);a=[];if(d=GetSelectedFormFields())for(var f=0;f<d.length;f++)a.push(d[f].fname);bindSFormCont7811q(a,c,b)}else b=$("#curFormInfoHead7811q").children().filter('li[fname\x3d"'+b+'"]'),renderIframe7811q(b);var g=0;$("#curFormInfoHead7811q").children().each(function(a,b){g=g+$(b).width()+22});$("#curFormInfoHead7811q").width(g);b=$(".curFormInfoHeadBox").height()+2;$("#curFormInfoCont7811q").css({top:b+"px"})}e.stopPropagation()}function renderIframe7811q(a){var b=$(a).attr("fname");0==$(a).hasClass("sel")&&($(a).addClass("sel").siblings().removeClass("sel"),$("#curFormInfoCont7811q").children('iframe[name\x3d"'+b+'"]').css({display:"block"}).siblings().css({display:"none"}))}function closeSubForm7811q(a){var b=$(a).parent().attr("fname"),e=$(a).parent().next();null==e[0]&&(e=$(a).parent().prev());var c=e.attr("fname");e.addClass("sel");$("#curFormInfoCont7811q").children('iframe[name\x3d"'+c+'"]').css({display:"block"});$("#curFormInfoCont7811q").children('iframe[name\x3d"'+b+'"]').remove();$(a).parent().remove();event.stopPropagation()}function bindSFormCont7811q(a,b,e){$("#"+b).on("load",function(){$("#"+b).contents().find("div[cnode\x3dshell]").filter("div[fname]").each(function(a,b){if(""!=$(this).attr("fname")&&null!=$(this).attr("fname")&&0<$(this).children().length){var d=$(this).children()[0].style.width,c=$(this).children()[0].style.height,e=$(this).children()[0].style.top,k=$(this).children()[0].style.left;$(this).append("\x3cdiv class\x3d'maskbox' style\x3d'width:"+d+";height:"+c+";top:"+e+";left:"+k+";'\x3e\x3c/div\x3e")}});resetSelected7811q(a,b);$("#"+b).contents().find("div[cnode\x3dshell]").filter("div[fname]").on("click",function(a){var b=$(this).attr("fname");e&&(b=e+"\x3e"+b);if(b=$("#formselectorul7811q").tree("find",b))$("#formselectorul7811q").tree("expandTo",b.target),$("#formselectorul7811q").tree("select",b.target),$("#formselectorul7811q").tree("scrollTo",b.target),"select"==$(this).attr("isSelect")?$("#formselectorul7811q").tree("uncheck",b.target):$("#formselectorul7811q").tree("check",b.target);a.stopPropagation()});$("#"+b).contents().find("div[rel\x3dSubData],div[rel\x3dattachment]").on("mouseenter",function(a){null!=$(this).find("#ib_rkmenubox")[0]&&$(this).find("#ib_rkmenubox").remove();var b=$(this).children(0).attr("formid");if(b){var c=$(this).attr("fname"),g=e,g=g?g+"\x3e"+c:c,c=parseInt($(this).children()[0].style.top)+35+"px",h=parseInt($(this).children()[0].style.left)+5+"px",b='\x3cdiv id\x3d"ib_rkmenubox" class\x3d"ib_rkmenubox" style\x3d"top:'+c+";left:"+h+';"\x3e\x3cdiv class\x3d"ib_rkmenuitem" onclick\x3d"parent.FSelectorOpenSubForm7811q(\''+b+"','"+g+"',event)\"\x3e\u6253\u5f00\u5b50\u8868\u5355\x3c/div\x3e \x3c/div\x3e";$(this).append(b)}a.stopPropagation()});$("#"+b).contents().find("div[rel\x3dSubData],div[rel\x3dattachment]").on("mouseleave",function(a){null!=$(this).find("#ib_rkmenubox")[0]&&$(this).find("#ib_rkmenubox").remove();a.stopPropagation()});$(".shadeMask").hide()})}function GetSelectedFormFields(){for(var a=[],b=$("#formselectorul7811q").tree("getChecked"),e=0;e<b.length;e++){var c=b[e].attributes.ftype;if(c){var d={};d.ftitle=b[e].text;d.ftype=c;d.fname=b[e].id;a.push(d)}}return a}var resetSelected7811q=function(a,b){treeUncheckedAll7811q();if(a)for(var e=0;e<a.length;e++){var c=findNode7811q(a[e]);c?$("#formselectorul7811q").tree("check",c.target):console.log("\u4e0d\u5b58\u5728\u8282\u70b9:"+a[e])}},findNode7811q=function(a){return a?$("#formselectorul7811q").tree("find",a):null},getSubFormTitle7811q=function(a){var b=findNode7811q(a);return null==b?a:b.text};function treeUncheckedAll7811q(){for(var a=$("#formselectorul7811q").tree("getChecked"),b=0;b<a.length;b++)$("#formselectorul7811q").tree("uncheck",a[b].target)}function formFieldSelectMode(a){if(0==a){a=$("#formselectorul7811q").tree("getChecked","unchecked");for(var b=0;b<a.length;b++)$("#formselectorul7811q").tree("check",a[b].target)}else if(1==a)for(a=$("#formselectorul7811q").tree("getChecked","checked"),b=0;b<a.length;b++)$("#formselectorul7811q").tree("uncheck",a[b].target);else if(2==a)for(a=$("#formselectorul7811q").tree("getChildren"),b=0;b<a.length;b++)"checked"==a[b].checkState?$("#formselectorul7811q").tree("uncheck",a[b].target):"unchecked"==a[b].checkState&&$("#formselectorul7811q").tree("check",a[b].target);else showError("\u65b9\u6cd5\u4f7f\u7528\u7684\u53c2\u6570\u4e0d\u6b63\u786e!")};
//# sourceMappingURL=FormSelector.min.js.map
