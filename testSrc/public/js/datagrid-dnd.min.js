(function(a){function x(k){a.map(k,function(c){a(c).droppable("enable")})}a.extend(a.fn.datagrid.defaults,{dropAccept:"tr.datagrid-row",dragSelection:!1,onBeforeDrag:function(a){},onStartDrag:function(a){},onStopDrag:function(a){},onDragEnter:function(a,c){},onDragOver:function(a,c){},onDragLeave:function(a,c){},onBeforeDrop:function(a,c,f){},onDrop:function(a,c,f){}});a.extend(a.fn.datagrid.methods,{_appendRow:function(k,c){return k.each(function(){var f=a(this),g=a.isArray(c)?c:[c];a.map(g,function(a){f.datagrid("appendRow",a).datagrid("enableDnd",f.datagrid("getRows").length-1);a._selected&&f.datagrid("selectRow",f.datagrid("getRows").length-1)})})},_insertRow:function(k,c){return k.each(function(){var f=a(this),g=c.index,l=c.row,l=a.isArray(l)?l:[l];a.map(l,function(a,c){f.datagrid("insertRow",{index:g+c,row:a}).datagrid("enableDnd",g+c);a._selected&&f.datagrid("selectRow",g+c)})})},_deleteRow:function(k,c){return k.each(function(){var f=a(this),g=a.isArray(c)?c:[c];a.map(g,function(a){a=f.datagrid("getRowIndex",a);f.datagrid("deleteRow",a)})})}});var p=[];a.extend(a.fn.datagrid.methods,{resetDroppable:function(k){return k.each(function(){for(var c=a(this).datagrid("getPanel")[0],f=[],g=[],l=0;l<p.length;l++){var k=p[l],u=a(k).closest("div.datagrid-wrap");u.length&&u[0]==c?f.push(k):g.push(k)}p=g;x(f)})},enableDnd:function(k,c){a("#datagrid-dnd-style").length||a('\x3cstyle id\x3d"datagrid-dnd-style"\x3e.datagrid-row-top\x3etd{border-top:1px solid red}.datagrid-row-bottom\x3etd{border-bottom:1px solid red}\x3c/style\x3e').appendTo("head");return k.each(function(){function f(b,d){a(b).draggable("proxy").find("span.tree-dnd-icon").removeClass("tree-dnd-yes tree-dnd-no").addClass(d?"tree-dnd-yes":"tree-dnd-no")}function k(b){if(!a(b).hasClass("datagrid-row"))return null;var d=a(b).closest("div.datagrid-view").children("table")[0];return a(d).datagrid("options").finder.getRow(d,a(b))}function l(b){if(!a(b).hasClass("datagrid-row"))return null;var d=a(b).closest("div.datagrid-view").children("table")[0],v=a(d).datagrid("options");if(v.dragSelection){var h=a(d).datagrid("getSelections");a.map(h,function(a){a._selected=!0});return h.length?h:(d=v.finder.getRow(d,a(b)),d._selected=!1,d)}d=v.finder.getRow(d,a(b));a(b).hasClass("datagrid-row-selected")&&(d._selected=!0);return d}function t(b){return a(b).closest("div.datagrid-view").children("table")[0]}function u(b){b=a(b).droppable("options");return b.disabled||"no-accept"==b.accept?!1:!0}var n=this,r=a.data(this,"datagrid"),w=a(this),m=r.options,z={accept:m.dropAccept,onDragEnter:function(b,d){function v(){0==m.onDragEnter.call(n,f,c)&&(e.removeClass("datagrid-row-top datagrid-row-bottom"),e.droppable("disable"),e.each(function(){p.push(this)}))}if(!a(this).droppable("options").disabled){var h=t(this),e=a(h).datagrid("options").finder.getTr(h,null,"highlight"),c=l(d),f=k(this);e.length&&f&&v()}},onDragOver:function(b,d){function c(){0==m.onDragOver.call(n,y,B)&&(f(d,!1),e.removeClass("datagrid-row-top datagrid-row-bottom"),e.droppable("disable"),e.each(function(){p.push(this)}))}if(!(a(this).droppable("options").disabled||0<=a.inArray(this,p))){var h=t(this),e=a(h).datagrid("options").finder.getTr(h,null,"highlight");if(e.length&&!u(e))f(d,!1);else{f(d,!0);var B=l(d),y=k(this);if(e.length){var h=d.pageY,g=e.offset().top,q=e.offset().top+e.outerHeight();e.removeClass("datagrid-row-top datagrid-row-bottom");h>g+(q-g)/2?e.addClass("datagrid-row-bottom"):e.addClass("datagrid-row-top");y&&c()}}}},onDragLeave:function(b,d){if(!a(this).droppable("options").disabled){f(d,!1);var c=t(this);a(c).datagrid("options").finder.getTr(c,a(this).attr("datagrid-row-index")).removeClass("datagrid-row-top datagrid-row-bottom");var c=l(d),h=k(this);h&&m.onDragLeave.call(n,h,c)}},onDrop:function(b,d){if(!a(this).droppable("options").disabled){var c=t(d),h=t(this),e=a(h).datagrid("options").finder.getTr(h,null,"highlight"),f=null,g=l(d),p=null;if(e.length){if(!u(e))return;f=e.hasClass("datagrid-row-top")?"top":"bottom";e.removeClass("datagrid-row-top datagrid-row-bottom");p=k(e)}if(0!=m.onBeforeDrop.call(n,p,g,f)){var q=parseInt(e.attr("datagrid-row-index"));f?h!=c?(e="top"==f?q:q+1,0<=e&&(a(c).datagrid("_deleteRow",g),a(h).datagrid("_insertRow",{index:e,row:g}))):(c=a(h),0<=("top"==f?q:q+1)&&(c.datagrid("_deleteRow",g),q=parseInt(e.attr("datagrid-row-index")),e="top"==f?q:q+1,0<=e&&c.datagrid("_insertRow",{index:e,row:g}))):(a(h).datagrid("_appendRow",g),a(c).datagrid("_deleteRow",g));m.onDrop.call(n,p,g,f)}}}},A=void 0!=c?m.finder.getTr(this,c):m.finder.getTr(this,0,"allbody");A.draggable({disabled:!1,revert:!0,cursor:"pointer",proxy:function(b){var d=a('\x3cdiv style\x3d"z-index:9999999999999"\x3e\x3c/div\x3e').appendTo("body");b=l(b);b=a.isArray(b)?b:[b];a.map(b,function(b,c){var e=w.datagrid("getRowIndex",b),f=m.finder.getTr(n,e,"body",1);m.finder.getTr(n,e,"body",2).clone().removeAttr("id").removeClass("droppable").appendTo(d);f.clone().removeAttr("id").removeClass("droppable").find("td").insertBefore(d.find("tr:eq("+c+") td:first"));a('\x3ctd\x3e\x3cspan class\x3d"tree-dnd-icon tree-dnd-no" style\x3d"position:static"\x3e\x26nbsp;\x3c/span\x3e\x3c/td\x3e').insertBefore(d.find("tr:eq("+c+") td:first"))});d.find("td").css("vertical-align","middle");d.hide();return d},deltaX:15,deltaY:15,onBeforeDrag:function(b){var d=l(this);if(0==m.onBeforeDrag.call(n,d)||a(b.target).parent().hasClass("datagrid-cell-check")||1!=b.which)return!1;a.map(a.isArray(d)?d:[d],function(b){b=a(n).datagrid("getRowIndex",b);m.finder.getTr(n,b).droppable({accept:"no-accept"})})},onStartDrag:function(){a(this).draggable("proxy").css({left:-1E4,top:-1E4});var b=l(this);m.onStartDrag.call(n,b);r.draggingRow=b},onDrag:function(b){var d=b.pageX,c=b.pageY,f=b.data.startX,e=b.data.startY;3<Math.sqrt((d-f)*(d-f)+(c-e)*(c-e))&&(a(this).draggable("proxy").show(),d=m.finder.getTr(n,parseInt(a(this).attr("datagrid-row-index")),"body"),a.extend(b.data,{startX:d.offset().left,startY:d.offset().top,offsetWidth:0,offsetHeight:0}));this.pageY=b.pageY},onStopDrag:function(){x(p);p=[];a.map(a.isArray(r.draggingRow)?r.draggingRow:[r.draggingRow],function(a){a=w.datagrid("getRowIndex",a);w.datagrid("enableDnd",a)});m.onStopDrag.call(n,r.draggingRow)}});A.droppable(z);a(n).data("datagrid").dc.view.droppable(z).droppable("enable")})}})})(jQuery);
//# sourceMappingURL=datagrid-dnd.min.js.map
