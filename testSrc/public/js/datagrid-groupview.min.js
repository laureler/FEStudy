$.extend($.fn.datagrid.defaults,{groupHeight:25,expanderWidth:30,groupStyler:function(d,b){return""}});var groupview=$.extend({},$.fn.datagrid.defaults.view,{render:function(d,b,a){for(var c=[],f=this.groups,e=0;e<f.length;e++)c.push(this.renderGroup.call(this,d,e,f[e],a));$(b).html(c.join(""))},renderGroup:function(d,b,a,c){var f=$.data(d,"datagrid"),e=f.options,l=$(d).datagrid("getColumnFields",c),g=e.frozenColumns&&e.frozenColumns.length;if(c&&!e.rownumbers&&!g)return"";var h=[],k=e.groupStyler.call(d,a.value,a.rows),n="",m="";"string"==typeof k?m=k:k&&(n=k["class"]||"",m=k.style||"");h.push("\x3cdiv group-index\x3d"+b+" "+('class\x3d"datagrid-group'+(n?" "+n:"")+'" style\x3d"'+m+'"')+"\x3e");if(c&&(e.rownumbers||e.frozenColumns.length)||!c&&!e.rownumbers&&!e.frozenColumns.length)h.push('\x3cspan class\x3d"datagrid-group-expander"\x3e'),h.push('\x3cspan class\x3d"datagrid-row-expander datagrid-row-collapse"\x3e\x26nbsp;\x3c/span\x3e'),h.push("\x3c/span\x3e");if(c&&g||!c)h.push('\x3cspan class\x3d"datagrid-group-title"\x3e'),h.push(e.groupFormatter.call(d,a.value,a.rows)),h.push("\x3c/span\x3e");h.push("\x3c/div\x3e");h.push('\x3ctable class\x3d"datagrid-btable" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0"\x3e\x3ctbody\x3e');b=a.startIndex;for(g=0;g<a.rows.length;g++)k=e.rowStyler?e.rowStyler.call(d,b,a.rows[g]):"",m=n="","string"==typeof k?m=k:k&&(n=k["class"]||"",m=k.style||""),h.push('\x3ctr id\x3d"'+(f.rowIdPrefix+"-"+(c?1:2)+"-"+b)+'" datagrid-row-index\x3d"'+b+'" '+('class\x3d"datagrid-row '+(b%2&&e.striped?"datagrid-row-alt ":" ")+n+'"')+" "+(m?'style\x3d"'+m+'"':"")+"\x3e"),h.push(this.renderRow.call(this,d,l,c,b,a.rows[g])),h.push("\x3c/tr\x3e"),b++;h.push("\x3c/tbody\x3e\x3c/table\x3e");return h.join("")},bindEvents:function(d){var b=$.data(d,"datagrid").dc,b=b.body1.add(b.body2),a=($.data(b[0],"events")||$._data(b[0],"events")).click[0].handler;b.unbind("click").bind("click",function(b){var c=$(b.target).closest("span.datagrid-row-expander");if(c.length){var e=c.closest("div.datagrid-group").attr("group-index");c.hasClass("datagrid-row-collapse")?$(d).datagrid("collapseGroup",e):$(d).datagrid("expandGroup",e)}else a(b);b.stopPropagation()})},onBeforeRender:function(d,b){function a(a){for(var b=0;b<e.length;b++){var c=e[b];if(c.value==a)return c}return null}var c=$.data(d,"datagrid"),f=c.options;$("#datagrid-group-style").length||$("head").append('\x3cstyle id\x3d"datagrid-group-style"\x3e.datagrid-group{height:'+f.groupHeight+"px;overflow:hidden;font-weight:bold;border-bottom:1px solid #ccc;white-space:nowrap;word-break:normal;}.datagrid-group-title,.datagrid-group-expander{display:inline-block;vertical-align:bottom;height:100%;line-height:"+f.groupHeight+"px;padding:0 4px;}.datagrid-group-title{position:relative;}.datagrid-group-expander{width:"+f.expanderWidth+"px;text-align:center;padding:0}.datagrid-row-expander{margin:"+Math.floor((f.groupHeight-16)/2)+"px 0;display:inline-block;width:16px;height:16px;cursor:pointer}\x3c/style\x3e");for(var e=[],l=0;l<b.length;l++){var g=b[l],h=a(g[f.groupField]);h?h.rows.push(g):(h={value:g[f.groupField],rows:[g]},e.push(h))}f=0;g=[];for(l=0;l<e.length;l++)h=e[l],h.startIndex=f,f+=h.rows.length,g=g.concat(h.rows);c.data.rows=g;this.groups=e;var k=this;setTimeout(function(){k.bindEvents(d)},0)},onAfterRender:function(d){$.fn.datagrid.defaults.view.onAfterRender.call(this,d);var b=this,a=$.data(d,"datagrid"),c=a.options;a.onResizeColumn||(a.onResizeColumn=c.onResizeColumn);a.onResize||(a.onResize=c.onResize);c.onResizeColumn=function(c,e){b.resizeGroup(d);a.onResizeColumn.call(d,c,e)};c.onResize=function(c,e){b.resizeGroup(d);a.onResize.call($(d).datagrid("getPanel")[0],c,e)};b.resizeGroup(d)}});$.extend($.fn.datagrid.methods,{groups:function(d){return d.datagrid("options").view.groups},expandGroup:function(d,b){return d.each(function(){var a=$.data(this,"datagrid").dc.view.find(void 0!=b?'div.datagrid-group[group-index\x3d"'+b+'"]':"div.datagrid-group"),c=a.find("span.datagrid-row-expander");c.hasClass("datagrid-row-expand")&&(c.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse"),a.next("table").show());$(this).datagrid("fixRowHeight")})},collapseGroup:function(d,b){return d.each(function(){var a=$.data(this,"datagrid").dc.view.find(void 0!=b?'div.datagrid-group[group-index\x3d"'+b+'"]':"div.datagrid-group"),c=a.find("span.datagrid-row-expander");c.hasClass("datagrid-row-collapse")&&(c.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand"),a.next("table").hide());$(this).datagrid("fixRowHeight")})},scrollToGroup:function(d,b){return d.each(function(){var a=$.data(this,"datagrid").dc,c=a.body2.children('div.datagrid-group[group-index\x3d"'+b+'"]');if(c.length){var d=c.outerHeight(),e=a.view2.children("div.datagrid-header")._outerHeight(),l=a.body2.outerHeight(!0)-a.body2.outerHeight(),c=c.position().top-e-l;0>c?a.body2.scrollTop(a.body2.scrollTop()+c):c+d>a.body2.height()-18&&a.body2.scrollTop(a.body2.scrollTop()+c+d-a.body2.height()+18)}})}});$.extend(groupview,{refreshGroupTitle:function(d,b){var a=$.data(d,"datagrid"),c=a.options,a=a.dc,f=this.groups[b];a.body1.add(a.body2).children("div.datagrid-group[group-index\x3d"+b+"]").find("span.datagrid-group-title").html(c.groupFormatter.call(d,f.value,f.rows))},resizeGroup:function(d,b){var a=$.data(d,"datagrid"),c=a.dc,f=c.header2.find("table"),e=f.find("tr.datagrid-filter-row").hide(),l=f.width(),f=void 0==b?c.body2.children("div.datagrid-group"):c.body2.children("div.datagrid-group[group-index\x3d"+b+"]");f._outerWidth(l);a=a.options;a.frozenColumns&&a.frozenColumns.length&&(a=c.view1.width()-a.expanderWidth,c="rtl"==c.view1.css("direction").toLowerCase(),f.find(".datagrid-group-title").css(c?"right":"left",-a+"px"));e.show()},insertRow:function(d,b,a){function c(a,b){var c=b?1:2,f=e.finder.getTr(d,a-1,"body",c);e.finder.getTr(d,a,"body",c).insertAfter(f)}var f=$.data(d,"datagrid"),e=f.options,l=f.dc,g=null,h;if(f.data.rows.length){for(var k=0;k<this.groups.length;k++)if(this.groups[k].value==a[e.groupField]){g=this.groups[k];h=k;break}if(g){if(void 0==b||null==b)b=f.data.rows.length;b<g.startIndex?b=g.startIndex:b>g.startIndex+g.rows.length&&(b=g.startIndex+g.rows.length);$.fn.datagrid.defaults.view.insertRow.call(this,d,b,a);b>=g.startIndex+g.rows.length&&(c(b,!0),c(b,!1));g.rows.splice(b-g.startIndex,0,a)}else g={value:a[e.groupField],rows:[a],startIndex:f.data.rows.length},h=this.groups.length,l.body1.append(this.renderGroup.call(this,d,h,g,!0)),l.body2.append(this.renderGroup.call(this,d,h,g,!1)),this.groups.push(g),f.data.rows.push(a);this.refreshGroupTitle(d,h);this.resizeGroup(d)}else $(d).datagrid("loadData",[a])},updateRow:function(d,b,a){var c=$.data(d,"datagrid").options;$.fn.datagrid.defaults.view.updateRow.call(this,d,b,a);b=c.finder.getTr(d,b,"body",2).closest("table.datagrid-btable");b=parseInt(b.prev().attr("group-index"));this.refreshGroupTitle(d,b)},deleteRow:function(d,b){var a=$.data(d,"datagrid"),c=a.options,a=a.dc,a=a.body1.add(a.body2),c=c.finder.getTr(d,b,"body",2).closest("table.datagrid-btable"),c=parseInt(c.prev().attr("group-index"));$.fn.datagrid.defaults.view.deleteRow.call(this,d,b);var f=this.groups[c];if(1<f.rows.length)f.rows.splice(b-f.startIndex,1),this.refreshGroupTitle(d,c);else{a.children("div.datagrid-group[group-index\x3d"+c+"]").remove();for(var e=c+1;e<this.groups.length;e++)a.children("div.datagrid-group[group-index\x3d"+e+"]").attr("group-index",e-1);this.groups.splice(c,1)}for(e=b=0;e<this.groups.length;e++)f=this.groups[e],f.startIndex=b,b+=f.rows.length}});
//# sourceMappingURL=datagrid-groupview.min.js.map
