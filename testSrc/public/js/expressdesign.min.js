/**
 * 表达式设计器 动态生成
 */
var expressCollect={formId:"",bBackServer:1,oprBtn:{save:{text:"\u4fdd\u5b58",value:"save",tip:"\u4fdd\u5b58\u8868\u8fbe\u5f0f"},debug:{text:"\u8c03\u8bd5\u8fd0\u884c",value:"debug",tip:""},getVal:{text:"\u83b7\u53d6\u503c",value:"getVal",tip:"",formIdCollect:"",exp:""},setVal:{text:"\u8bbe\u7f6e\u503c",value:"setVal",tip:"",formIdCollect:"",exp:""},getSysField:{text:"\u83b7\u53d6\u7cfb\u7edf\u5b57\u6bb5",value:"getSysField",tip:"",formIdCollect:"",exp:""},getCustomField:{text:"\u83b7\u53d6\u81ea\u5b9a\u4e49\u5b57\u6bb5",value:"getCustomField",tip:"",formIdCollect:"",exp:""}}};document.write("\x3clink href\x3d'/public/codemirror/codemirror-5.32.0/lib/codemirror.css' rel\x3d'stylesheet'/\x3e");document.write("\x3clink href\x3d'/public/codemirror/codemirror-5.32.0/theme/ambiance.css' rel\x3d'stylesheet'/\x3e");document.write("\x3cscript type\x3d'text/javascript' src\x3d'/public/codemirror/codemirror-5.32.0/lib/codemirror.js'\x3e\x3c/script\x3e");document.write("\x3cscript type\x3d'text/javascript' src\x3d'/public/codemirror/codemirror-5.32.0/mode/javascript/javascript.js'\x3e\x3c/script\x3e");document.write("\x3cscript type\x3d'text/javascript' src\x3d'/public/js/FormObjectSelector.js'\x3e\x3c/script\x3e");document.write("\x3cscript type\x3d'text/javascript' src\x3d'/public/js/FormSelector.js'\x3e\x3c/script\x3e");document.write("\x3cscript type\x3d'text/javascript' src\x3d'/public/js/exprruntimetest.js'\x3e\x3c/script\x3e");function openExpress(d,c,a,e,b){expressCollect.bBackServer=e?e:0;expressCollect.formId=b?b:"";b="";b=a?b+'\x3cdiv id\x3d"expresswin7811q" style\x3d"width:100%;height:100%"\x3e':b+('\x3cdiv id\x3d"expresswin7811qBox"\x3e\x3cdiv id\x3d"expresswin7811q" class\x3d"easyui-dialog"  title\x3d"'+(e?"\u8868\u8fbe\u5f0f\u8bbe\u8ba1\u5668-\u540e\u7aef\u8868\u8fbe\u5f0f":"\u8868\u8fbe\u5f0f\u8bbe\u8ba1\u5668-\u524d\u7aef\u8868\u8fbe\u5f0f")+'" style\x3d"width:700px;height:500px" data-options\x3d"maximized:true,maximizable:true,buttons:\'#win-express-footer-btns\'"\x3e');b+='\x3cdiv class\x3d"easyui-layout" data-options\x3d"fit:true" style\x3d"height:100%"\x3e\x3cdiv data-options\x3d"region:\'center\',collapsible:false" style\x3d"box-sizing: border-box;overflow:hidden;"\x3e\x3ctextarea id\x3d"expressionDesignerText" style\x3d"height:100%;width:100%;"\x3e\x3c/textarea\x3e\x3cdiv id\x3d"validateBox" class\x3d"validateBox"\x3e\x3cdiv id\x3d"validateTxt"\x3e\x3c/div\x3e\x3cdiv class\x3d"closeValdateTxt" onclick\x3d"closeValdateTxt()"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv data-options\x3d"region:\'south\',border:false,collapsible:true" style\x3d"height:200px;"\x3e \x3cdiv id\x3d"signButtonId" style\x3d"padding: 5px 10px;border: 1px solid #e1e1e1;"\x3e';for(var f in expressCollect.oprBtn)e=expressCollect.oprBtn[f],"save"==f&&a||("debug"==f?(b+='\x3cinput id\x3d"expresswin7811qBox-DgsJid" type\x3d"text" style\x3d"float: right;height: 20px;" placeholder\x3d"\u8bf7\u8f93\u5165\u8c03\u8bd5\u73af\u5883\u7684\u4e1a\u52a1\u53f7"\x3e',b+='\x3ca href\x3d"#" class\x3d"easyui-linkbutton mr5" style\x3d"float:right" onclick\x3d"expToolbarClk(\''+e.value+"')\"\x3e"+e.text+"\x3c/a\x3e"):b+='\x3ca href\x3d"#" class\x3d"easyui-linkbutton mr5" onclick\x3d"expToolbarClk(\''+e.value+"')\"\x3e"+e.text+"\x3c/a\x3e");b+='\x3c/div\x3e\x3cdiv class\x3d"easyui-layout" data-options\x3d"fit:true,border:false" style\x3d"width:100%;height:100%;"\x3e\x3cdiv data-options\x3d"region:\'west\',split:true" style\x3d"width:40%;overflow-x:hidden;"\x3e \x3cdiv style\x3d"margin:4px 0;"\x3e\x3cul class\x3d"easyui-tree" id\x3d"baseObj"\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv data-options\x3d"region:\'center\',split:true" title\x3d"\u63cf\u8ff0" style\x3d"width:60%;"\x3e\x3cul id\x3d"decriptionId" style\x3d"margin:0 10px;"\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e';$("#expresswin7811q").dialog("open");a?($("#"+a).append(b),$.parser.parse("#"+a)):($("body").append(b),$.parser.parse("#expresswin7811qBox"));initCtrl(d);var g=function(){$("#expresswin7811q").dialog("close")};this.getEditorContentTxt=function(){var a=validExpress(!1,"");!0===a?(a=expressCollect.editor.getValue(),g(),c&&c(a)):!1!==a&&$.messager.confirm("\u63d0\u793a","\u8868\u8fbe\u5f0f\u5b58\u5728\u95ee\u9898\uff1a"+a+"\uff0c\u662f\u5426\u7ee7\u7eed\u4fdd\u5b58",function(a){a&&(a=expressCollect.editor.getValue(),g(),c&&c(a))})}}var saveEditorContentTxt=function(){return expressCollect.editor.getValue()};function initCtrl(d){expressCollect.editor=CodeMirror.fromTextArea(document.getElementById("expressionDesignerText"),{lineNumbers:!0,mode:"text/javascript",theme:"ambiance"});expressCollect.editor.setSize("auto","100%");expressCollect.editor.setValue(d);expToolbarClk=function(c){var a=function(a){var b=expressCollect.formId,c=function(b){ShowFormSelector(b,[],function(b){for(var c=[],d=0;d<b.length;d++)c.push(b[d].fname);a&&a(c)})};b?c(b):FormObjectSelector([],!0,function(a){a[0].id&&c(a[0].id)})};switch(c){case "save":getEditorContentTxt();break;case "debug":c=$("#expresswin7811qBox-DgsJid").val();validExpress(!0,c);break;case "getVal":a(function(a){for(var b=0,c=a.length;b<c;b++)setExpressionValue("var gV"+b+' \x3d $.F.getFieldValue("'+a[b]+'");')});break;case "setVal":a(function(a){for(var b=0,c=a.length;b<c;b++)setExpressionValue("var sV"+b+' \x3d $.F.setFieldValue("'+a[b]+'");')});break;case "getSysField":createJobBaseDialog();break;case "getCustomField":a(function(a){setExpressionValue(a.join(","))})}};$("#signButtonId\x3ea").hover(function(){if(0!=$("body").find(".tip").length)$("body").find(".tip").remove();else{for(var c=$(this).attr("id"),a=0;a<expressCollect.oprBtn.length;a++)if(expressCollect.oprBtn[a].key==c)var d=expressCollect.oprBtn[a].tip;var c=$(this).offset().top,a=$(this).offset().left,b="\x3cdiv class\x3d'tip'\x3e"+d+"\x3c/div\x3e",f=$(this).parentsUntil("div[class\x3dwindow]")[4].style.zIndex,f=null==f?1E4:f;void 0!=d&&($("body").append(b),$(".tip").css({top:c+25,left:a,"z-index":f}))}},function(){if(0!=$("body").find(".tip").length)$("body").find(".tip").remove();else return!1});$.ajax({url:"/public/js/expJson.json",type:"GET",success:function(c){$("#baseObj").tree({data:c,state:closed,animate:!1,onClick:function(a){"root"!=a.domType&&$("#decriptionId").html("\x3cli\x3e"+a.decripHtml+"\x3c/li\x3e")},onDblClick:function(a){"root"!=a.domType&&setExpressionValue(a.id)}})},error:function(){}})}function setExpressionValue(d){expressCollect.editor.replaceSelection(d)}function createJobBaseDialog(){null==$("#jobBaseDialog")[0]&&($("body").append('\x3cdiv id\x3d"jobBaseDialog" class\x3d"easyui-dialog"\x3e\x3cdiv style\x3d"padding:10px 5px;border-bottom:1px solid #efefef;"\x3e\x3cspan\x3e\u4e1a\u52a1\u57fa\u8868\uff1a\x3c/span\x3e\x3cselect id\x3d"baseFormId" name\x3d"dept" style\x3d"width:83%;height:25px" onchange\x3d"showBaseForm()"\x3e\x3coption\x3e\u8bf7\u9009\u62e9...\x3c/option\x3e\x3coption value\x3d"job_base"\x3ejob_base\x3c/option\x3e\x3coption value\x3d"act_ru_execution"\x3eact_ru_execution\x3c/option\x3e\x3coption value\x3d"act_ru_task"\x3eact_ru_task\x3c/option\x3e\x3c/select\x3e\x3c/div\x3e\x3cdiv id\x3d"baseListId" style\x3d"height:370px"\x3e\x3c/div\x3e\x3c/div\x3e'),console.log("%c \u4e0d\u5b58\u5728","background:orange"));console.log("%c \u5df2\u7ecf\u5b58\u5728","background:orange");$("#jobBaseDialog").dialog({title:"\u9009\u62e9\u4e1a\u52a1\u57fa\u8868\u5b57\u6bb5",width:400,height:500,close:!1,modal:!0,buttons:[{text:"\u786e\u5b9a",handler:function(){var d=$("#baseListId").datalist("getSelected");d&&setExpressionValue('"'+d.fname+'"');$("#jobBaseDialog").dialog("close")}},{text:"\u5173\u95ed",handler:function(){$("#jobBaseDialog").dialog("close")}}]})}function showBaseForm(){var d=$("#baseFormId option:selected").text();$("#baseListId").datalist({url:"/formengineWebService/getFormDomains?forminforid\x3d"+d,valueField:"rid",textField:"ftitle",checkbox:!0,lines:!0})}function ReplaceAll(d,c,a){for(;0<=d.indexOf(c);)d=d.replace(c,a);return d}function validExpress(d,c){var a=expressCollect.editor.getValue();if(!a)return!0;a=$.trim(a);if(a=DebugExpr(expressCollect.bBackServer,a,d,c||""))return a=a.toString(),0<=a.indexOf("SyntaxError")?(createValidateTxt(!1,"\u9a8c\u8bc1\u5931\u8d25\uff01"+a.message),!1):a.message;createValidateTxt(!0,"\u9a8c\u8bc1\u901a\u8fc7\uff01");return!0}function createValidateTxt(d,c){d?$("#validateBox").css({display:"block",background:"#f1f5fc"}):$("#validateBox").css({display:"block",background:"#fcf1f1"});$("#validateTxt").text(c)}function closeValdateTxt(){$("#validateBox").css({display:"none"})};
//# sourceMappingURL=expressdesign.min.js.map
